<article>
  <form method="post" action="/e/<%= @page.name %>">
    <aside>
      <a href="/<%= @page.name %>" class="nav_link">back</a>
      &bull; <a href="/a/file/upload/<%= @page.name %>" class="nav_link">attach</a>
      <% if @page.tracked? %>
        &bull; <a href="/h/<%= @page.name %>" class="nav_link">history</a>
      <% end %>
      &bull; <input type="submit" value="Save" class="submit" />
      <section class="context">
        <% if @page.name =~ /\d\d\d\d-\d\d-\d\d/ %>
          <% require 'date'; date = Date.parse(@page.name) %>
          <a href="/<%= date.prev_day %>" class="nav_link">previous day</a>
          &bull; <a href="/<%= date.next_day %>" class="nav_link">next day</a>
        <% end %>
      </section>
    </aside>

    <header>
      <h1>Editing <a href="/<%= @page.name %>"><%= @page.name %></a></h1>
      <% if @page.name =~ /\d\d\d\d-\d\d-\d\d/ %>
        <% require 'date'; date = Date.parse(@page.name) %>
        <p><time datetime="<%= date %>"><%= date.strftime("%A %e %B %Y") %></time></p>
      <% end %>
    </header>

    <% if files = @page.attachments %>
      <section class="attachments">
        <h3>Attachments</h3>
        <% files.each do |file| %>
          <li><a href="<%= file.link_path %>"><%= file.name %></a>
            <span class="detail">(<%= file.size %>)</span>
            <div class="attach-options">
              <a href="<%= file.delete_path %>">delete</a>
              &bull; <a href="<%= file.link_path %>">download</a>
              <% if file.image? %>
              &bull; <a href="#" onClick="$(edit_textarea).html($(edit_textarea).html() + '!<%= file.link_path %>!');">insert &#187;</a>
              <% else %>
              &bull; <a href="#" onClick="$(edit_textarea).html($(edit_textarea).html() + '[<%= file.name %>](<%= file.link_path %>)');">insert &#187;</a>
              <% end %>
            </div>
          </span>
        <% end %>
      </section>
    <% end %>

    <textarea name="body" class="body"><%= @page.raw_body %></textarea>
    <label for="message">Message:</label>
    <textarea name="message" rows="4" class="message"></textarea>
    <p class="right"><input type="submit" value="Save" class="submit" /></p>
  </form>
</article>
